---
// HTML Content Renderer - Specialized component for rendering HTML MCards
interface Props {
  content: string;
  hash: string;
  metadata?: any;
}

const { content, hash, metadata } = Astro.props as Props;
---

<div class="html-renderer" data-hash={hash}>
  <article class="prose dark:prose-invert max-w-none" id={`html-content-${hash}`}>
    <!-- Content will be rendered by client-side script -->
  </article>
</div>

<script is:inline define:vars={{ content, hash }}>
  // HTML rendering with sanitization and KaTeX support
  document.addEventListener('DOMContentLoaded', async () => {
    const container = document.getElementById(`html-content-${hash}`);
    if (!container) return;

    try {
      // Load rendering libraries
      const libs = await window.ensureRenderLibs?.() || {
        DOMPurify: { sanitize: (html) => html },
        renderMathInElement: () => {}
      };

      // Sanitize and render HTML
      const safe = libs.DOMPurify.sanitize(content, { USE_PROFILES: { html: true } });
      container.innerHTML = safe;

      // Render math
      try {
        libs.renderMathInElement(container, {
          delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
            {left: '\\(', right: '\\)', display: false},
            {left: '\\[', right: '\\]', display: true}
          ]
        });
      } catch (e) {
        console.warn('Math rendering failed:', e);
      }
    } catch (error) {
      console.error('HTML rendering failed:', error);
      container.innerHTML = `<pre class="whitespace-pre-wrap">${content}</pre>`;
    }
  });
</script>

<style>
  .html-renderer {
    width: 100%;
    height: 100%;
    overflow: auto;
  }
</style>
